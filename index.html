<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Gas Station Frenzy</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#1a1a2e;font-family:'Segoe UI',system-ui,-apple-system,sans-serif;display:flex;justify-content:center;align-items:flex-start;min-height:100vh;overflow-x:hidden;padding-top:10px;color:#e2e8f0}
#game-wrapper{width:800px;transform-origin:top center;position:relative}

/* â”€â”€ HUD â”€â”€ */
#hud{background:linear-gradient(135deg,#16213e,#1a1a40);padding:10px 18px;display:flex;justify-content:space-between;align-items:center;border-radius:12px 12px 0 0;border:2px solid #2a3a5c;border-bottom:none;gap:8px;flex-wrap:wrap}
.hud-item{display:flex;align-items:center;gap:5px;font-size:.85rem;font-weight:600;white-space:nowrap}
.hud-icon{font-size:1rem}
.hud-val{color:#68d391;font-variant-numeric:tabular-nums}
.hud-val.warn{color:#fbd38d}
.hud-val.danger{color:#fc8181}
#sat-bar{width:80px;height:7px;background:#2d3748;border-radius:4px;overflow:hidden}
#sat-fill{height:100%;background:#68d391;border-radius:4px;transition:width .3s,background .3s}

/* â”€â”€ Game Area â”€â”€ */
#game-area{width:800px;height:550px;background:#5a6577;position:relative;overflow:hidden;border:2px solid #2a3a5c;border-top:none;border-radius:0 0 12px 12px;cursor:default;user-select:none}

/* Road */
.road{position:absolute;top:0;left:0;width:100%;height:42px;background:#3a4255;border-bottom:3px solid #d69e2e}
.road-dash{position:absolute;top:18px;height:3px;width:28px;background:#d69e2e;border-radius:2px}

/* Canopy */
.canopy{position:absolute;top:44px;left:25px;right:25px;height:125px;background:linear-gradient(135deg,#c0392b,#e74c3c);border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,.35)}
.canopy-title{position:absolute;top:4px;left:50%;transform:translateX(-50%);font-size:.6rem;font-weight:800;color:rgba(255,255,255,.25);letter-spacing:3px;text-transform:uppercase}

/* Station shared */
.station{position:absolute;border-radius:10px;cursor:pointer;transition:box-shadow .2s,transform .15s;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;z-index:2}
.station:hover{transform:scale(1.04);z-index:5}
.station.active{box-shadow:0 0 0 3px #9f7aea,0 0 16px rgba(159,122,234,.4) !important}
.station.needs-attention{animation:pulseWarn 1s infinite}
.station.critical{animation:pulseCrit .6s infinite}
@keyframes pulseWarn{0%,100%{box-shadow:0 0 0 2px #ecc94b}50%{box-shadow:0 0 0 4px #ecc94b,0 0 12px rgba(236,201,75,.4)}}
@keyframes pulseCrit{0%,100%{box-shadow:0 0 0 2px #fc8181}50%{box-shadow:0 0 0 5px #fc8181,0 0 16px rgba(252,129,129,.5)}}
.station-icon{font-size:1.6rem;line-height:1;pointer-events:none}
.station-label{font-size:.62rem;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:rgba(255,255,255,.85);pointer-events:none}
.station-sub{font-size:.75rem;pointer-events:none;min-height:1.1em}

/* Status bar inside stations */
.sbar{width:80%;height:5px;background:rgba(0,0,0,.25);border-radius:3px;overflow:hidden;margin-top:1px;pointer-events:none}
.sbar-fill{height:100%;border-radius:3px;transition:width .3s}
.sbar-fill.green{background:#68d391}
.sbar-fill.yellow{background:#ecc94b}
.sbar-fill.red{background:#fc8181}
.sbar-fill.blue{background:#63b3ed}

/* Pump stations */
.pump-station{width:145px;height:95px;background:linear-gradient(135deg,#2d3748,#3a4556);border:2px solid #4a5568}
.pump-station .car-slot{font-size:1.4rem;position:absolute;bottom:2px;left:50%;transform:translateX(-50%);pointer-events:none;opacity:0;transition:opacity .3s}
.pump-station .car-slot.visible{opacity:1}

/* Area backgrounds */
.area-bg{position:absolute;border-radius:10px;z-index:0}
#parking-bg{top:190px;left:25px;width:365px;height:115px;background:linear-gradient(135deg,#6b7a8d,#7a8899);border:2px dashed #8a99aa}
#bathroom-bg{top:190px;left:420px;width:355px;height:115px;background:linear-gradient(135deg,#5a6b7d,#6a7b8d);border:2px solid #7a8b9d}
#store-bg{top:325px;left:25px;width:750px;height:175px;background:linear-gradient(135deg,#edf2f7,#e2e8f0);border:2px solid #cbd5e0;box-shadow:inset 0 2px 8px rgba(0,0,0,.05)}
#store-label{position:absolute;top:330px;left:50%;transform:translateX(-50%);font-size:.55rem;font-weight:800;color:rgba(0,0,0,.15);letter-spacing:4px;text-transform:uppercase;z-index:1}

/* Cleaning stations */
.clean-station{width:145px;height:80px;border:2px solid rgba(255,255,255,.15)}
#parking-station{background:linear-gradient(135deg,#5a6a7d,#6a7a8d);top:205px;left:140px}
#bathroom-station{background:linear-gradient(135deg,#4a5b6d,#5a6b7d);top:205px;left:530px}

/* Store stations */
.store-station{width:185px;height:120px;border:2px solid #a0aec0}
#counter-station{background:linear-gradient(135deg,#fff,#f7fafc);top:345px;left:50px;color:#2d3748}
#counter-station .station-label{color:#4a5568}
#cooler-station{background:linear-gradient(135deg,#ebf8ff,#e6fffa);top:345px;left:280px;color:#2d3748}
#cooler-station .station-label{color:#2b6cb0}
#floor-station{background:linear-gradient(135deg,#fff,#f7fafc);top:345px;left:520px;color:#2d3748}
#floor-station .station-label{color:#4a5568}
.store-station .station-sub{color:#718096}

/* Clerk */
#clerk{position:absolute;z-index:10;font-size:1.8rem;transition:none;pointer-events:none;filter:drop-shadow(0 2px 4px rgba(0,0,0,.4))}
#clerk-label{position:absolute;z-index:11;font-size:.55rem;font-weight:700;color:#fff;background:#805ad5;padding:1px 6px;border-radius:8px;white-space:nowrap;pointer-events:none;opacity:0;transition:opacity .2s}
#clerk-label.visible{opacity:1}

/* Progress ring around clerk */
#clerk-progress{position:absolute;z-index:12;pointer-events:none}

/* Float text */
.float-text{position:absolute;font-weight:800;font-size:.95rem;color:#68d391;z-index:20;pointer-events:none;animation:floatUp 1.2s ease-out forwards}
.float-text.bad{color:#fc8181}
@keyframes floatUp{0%{opacity:1;transform:translateY(0)}100%{opacity:0;transform:translateY(-50px)}}

/* â”€â”€ Screens â”€â”€ */
.screen-overlay{position:absolute;top:0;left:0;width:100%;height:100%;z-index:50;display:none;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:30px}
.screen-overlay.show{display:flex}
#title-screen{background:linear-gradient(135deg,rgba(26,26,46,.97),rgba(22,33,62,.97))}
#dayend-screen{background:rgba(22,33,62,.95)}
#gameover-screen{background:rgba(26,10,10,.95)}

.screen-title{font-size:2.2rem;font-weight:800;margin-bottom:4px}
.screen-sub{font-size:.9rem;color:#a0aec0;margin-bottom:20px;max-width:400px;line-height:1.5}
.screen-stats{margin:10px 0 18px;font-size:.9rem;line-height:2}
.screen-stats span{color:#68d391;font-weight:700}
.btn{padding:12px 36px;font-family:inherit;font-size:1rem;font-weight:700;border:none;border-radius:10px;cursor:pointer;transition:transform .15s,box-shadow .2s;letter-spacing:.5px}
.btn:hover{transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,.3)}
.btn:active{transform:translateY(0)}
.btn-primary{background:linear-gradient(135deg,#68d391,#48bb78);color:#1a202c}
.btn-danger{background:linear-gradient(135deg,#fc8181,#f56565);color:#fff}
.btn-secondary{background:linear-gradient(135deg,#a0aec0,#718096);color:#fff;margin-top:8px;padding:8px 24px;font-size:.85rem}

.instructions{background:rgba(255,255,255,.06);border-radius:10px;padding:14px 20px;margin:14px 0;font-size:.78rem;color:#a0aec0;line-height:1.65;text-align:left;max-width:420px}
.instructions b{color:#e2e8f0}

.high-score{font-size:.75rem;color:#a0aec0;margin-top:10px}
.high-score span{color:#fbd38d;font-weight:700}

/* Day banner */
#day-banner{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:40;font-size:2.5rem;font-weight:800;color:#fff;text-shadow:0 4px 20px rgba(0,0,0,.5);opacity:0;pointer-events:none}
#day-banner.show{animation:bannerPop 2s ease-out forwards}
@keyframes bannerPop{0%{opacity:0;transform:translate(-50%,-50%) scale(.5)}15%{opacity:1;transform:translate(-50%,-50%) scale(1.1)}30%{transform:translate(-50%,-50%) scale(1)}80%{opacity:1}100%{opacity:0;transform:translate(-50%,-50%) scale(1)}}

/* Responsive */
@media(max-width:830px){
  body{padding-top:0;align-items:flex-start}
}
</style>
</head>
<body>
<div id="game-wrapper">
  <!-- HUD -->
  <div id="hud">
    <div class="hud-item"><span class="hud-icon">ğŸ’°</span><span class="hud-val" id="hud-money">$0</span></div>
    <div class="hud-item"><span class="hud-icon">ğŸ“…</span><span class="hud-val" id="hud-day">Day 1</span></div>
    <div class="hud-item"><span class="hud-icon">â±ï¸</span><span class="hud-val" id="hud-time">1:30</span></div>
    <div class="hud-item"><span class="hud-icon">â­</span><div id="sat-bar"><div id="sat-fill" style="width:100%"></div></div><span class="hud-val" id="hud-sat">100%</span></div>
    <div class="hud-item"><span class="hud-icon">ğŸ¯</span><span class="hud-val" id="hud-goal">$0/$60</span></div>
  </div>

  <!-- Game Area -->
  <div id="game-area">
    <!-- Road -->
    <div class="road" id="road"></div>

    <!-- Canopy -->
    <div class="canopy"><span class="canopy-title">Gas Station Frenzy</span></div>

    <!-- Pumps -->
    <div class="station pump-station" id="pump-0" style="top:60px;left:50px">
      <div class="station-icon">â›½</div>
      <div class="station-label">Pump 1</div>
      <div class="station-sub" id="pump-0-sub"></div>
      <div class="sbar"><div class="sbar-fill green" id="pump-0-bar" style="width:0%"></div></div>
      <div class="car-slot" id="car-0">ğŸš—</div>
    </div>
    <div class="station pump-station" id="pump-1" style="top:60px;left:215px">
      <div class="station-icon">â›½</div>
      <div class="station-label">Pump 2</div>
      <div class="station-sub" id="pump-1-sub"></div>
      <div class="sbar"><div class="sbar-fill green" id="pump-1-bar" style="width:0%"></div></div>
      <div class="car-slot" id="car-1">ğŸš™</div>
    </div>
    <div class="station pump-station" id="pump-2" style="top:60px;left:385px">
      <div class="station-icon">â›½</div>
      <div class="station-label">Pump 3</div>
      <div class="station-sub" id="pump-2-sub"></div>
      <div class="sbar"><div class="sbar-fill green" id="pump-2-bar" style="width:0%"></div></div>
      <div class="car-slot" id="car-2">ğŸš•</div>
    </div>
    <div class="station pump-station" id="pump-3" style="top:60px;left:555px">
      <div class="station-icon">â›½</div>
      <div class="station-label">Pump 4</div>
      <div class="station-sub" id="pump-3-sub"></div>
      <div class="sbar"><div class="sbar-fill green" id="pump-3-bar" style="width:0%"></div></div>
      <div class="car-slot" id="car-3">ğŸï¸</div>
    </div>

    <!-- Area backgrounds -->
    <div class="area-bg" id="parking-bg"></div>
    <div class="area-bg" id="bathroom-bg"></div>
    <div class="area-bg" id="store-bg"></div>
    <div id="store-label">â€” Store Interior â€”</div>

    <!-- Parking lot station -->
    <div class="station clean-station" id="parking-station">
      <div class="station-icon">ğŸ§¹</div>
      <div class="station-label">Parking Lot</div>
      <div class="station-sub" id="parking-sub">Clean</div>
      <div class="sbar"><div class="sbar-fill green" id="parking-bar" style="width:100%"></div></div>
    </div>

    <!-- Bathroom station -->
    <div class="station clean-station" id="bathroom-station">
      <div class="station-icon">ğŸš»</div>
      <div class="station-label">Bathroom</div>
      <div class="station-sub" id="bathroom-sub">Clean</div>
      <div class="sbar"><div class="sbar-fill green" id="bathroom-bar" style="width:100%"></div></div>
    </div>

    <!-- Counter station -->
    <div class="station store-station" id="counter-station">
      <div class="station-icon">ğŸ›’</div>
      <div class="station-label">Counter</div>
      <div class="station-sub" id="counter-sub">No customers</div>
      <div class="sbar"><div class="sbar-fill green" id="counter-bar" style="width:0%"></div></div>
    </div>

    <!-- Cooler station -->
    <div class="station store-station" id="cooler-station">
      <div class="station-icon">â„ï¸</div>
      <div class="station-label">Coolers</div>
      <div class="station-sub" id="cooler-sub">Stocked</div>
      <div class="sbar"><div class="sbar-fill blue" id="cooler-bar" style="width:100%"></div></div>
    </div>

    <!-- Floor station -->
    <div class="station store-station" id="floor-station">
      <div class="station-icon">ğŸ§½</div>
      <div class="station-label">Floor</div>
      <div class="station-sub" id="floor-sub">Clean</div>
      <div class="sbar"><div class="sbar-fill green" id="floor-bar" style="width:100%"></div></div>
    </div>

    <!-- Clerk -->
    <div id="clerk">ğŸ‘·</div>
    <div id="clerk-label">Idle</div>
    <div id="clerk-progress">
      <svg width="36" height="36" viewBox="0 0 36 36">
        <circle cx="18" cy="18" r="15" fill="none" stroke="rgba(0,0,0,.2)" stroke-width="3"/>
        <circle id="prog-ring" cx="18" cy="18" r="15" fill="none" stroke="#9f7aea" stroke-width="3" stroke-dasharray="94.25" stroke-dashoffset="94.25" stroke-linecap="round" transform="rotate(-90 18 18)"/>
      </svg>
    </div>

    <!-- Day banner -->
    <div id="day-banner">Day 1</div>

    <!-- SCREENS -->
    <div class="screen-overlay show" id="title-screen">
      <div class="screen-title">â›½ Gas Station Frenzy</div>
      <div class="screen-sub">Run the busiest gas station in town! Keep customers happy, shelves stocked, and everything sparkling clean.</div>
      <div class="instructions">
        <b>How to play:</b><br>
        ğŸ–±ï¸ Click stations to send your clerk there<br>
        â›½ <b>Pumps</b> â€” Activate when cars arrive, don't let them wait!<br>
        â„ï¸ <b>Coolers</b> â€” Restock before they empty out<br>
        ğŸ›’ <b>Counter</b> â€” Serve walk-in customers quickly<br>
        ğŸš» <b>Bathroom</b> â€” Keep it clean or satisfaction drops<br>
        ğŸ§¹ <b>Parking / Floor</b> â€” Sweep and mop to stay tidy<br><br>
        â­ Keep satisfaction high for bonus tips!<br>
        ğŸ¯ Hit your daily earnings goal to advance!
      </div>
      <button class="btn btn-primary" onclick="startGame()">Start Day 1</button>
      <div class="high-score" id="title-highscore"></div>
    </div>

    <div class="screen-overlay" id="dayend-screen">
      <div class="screen-title" id="dayend-title">Day Complete!</div>
      <div class="screen-stats" id="dayend-stats"></div>
      <button class="btn btn-primary" id="dayend-btn" onclick="nextDay()">Next Day</button>
      <button class="btn btn-secondary" onclick="restartGame()">Restart</button>
    </div>

    <div class="screen-overlay" id="gameover-screen">
      <div class="screen-title">ğŸ’€ Game Over</div>
      <div class="screen-sub" id="gameover-reason"></div>
      <div class="screen-stats" id="gameover-stats"></div>
      <button class="btn btn-danger" onclick="restartGame()">Try Again</button>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONSTANTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DAY_LENGTH = 90;
const CLERK_SPEED = 220;
const CARS = ['ğŸš—','ğŸš™','ğŸš•','ğŸï¸','ğŸš—','ğŸš™'];

const STATION_POS = {
  pump0:{x:122,y:165}, pump1:{x:287,y:165}, pump2:{x:457,y:165}, pump3:{x:627,y:165},
  parking:{x:212,y:300}, bathroom:{x:602,y:300},
  counter:{x:142,y:475}, coolers:{x:372,y:475}, floor:{x:612,y:475}
};

const TASK_DURATION = {
  pump0:1, pump1:1, pump2:1, pump3:1,
  parking:3, bathroom:4,
  counter:2, coolers:3, floor:3
};

function dayConfig(day) {
  return {
    carInterval: Math.max(4, 15 - day * 1.8),
    counterInterval: Math.max(6, 20 - day * 2),
    degradeMultiplier: 1 + day * 0.25,
    patience: Math.max(10, 28 - day * 2),
    goal: 40 + day * 35
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let G = {};

function freshState() {
  return {
    screen: 'title',
    day: 1,
    totalMoney: 0,
    dayMoney: 0,
    satisfaction: 100,
    timeLeft: DAY_LENGTH,
    customersServed: 0,
    dayCustomers: 0,

    clerk: { x:400, y:510, targetKey:null, arrived:false, taskProgress:0, taskDuration:0 },

    pumps: [
      {state:'empty', patience:0, maxPatience:28, fillProgress:0, carType:'ğŸš—', payment:0},
      {state:'empty', patience:0, maxPatience:28, fillProgress:0, carType:'ğŸš™', payment:0},
      {state:'empty', patience:0, maxPatience:28, fillProgress:0, carType:'ğŸš•', payment:0},
      {state:'empty', patience:0, maxPatience:28, fillProgress:0, carType:'ğŸï¸', payment:0}
    ],

    coolerStock: 100,
    counterQueue: 0,
    counterPatience: 0,
    counterMaxPatience: 20,
    bathroomClean: 100,
    floorClean: 100,
    parkingClean: 100,

    nextCarTimer: 5,
    nextCounterTimer: 12,

    paused: false,
    dayStarted: false
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOM REFS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const $ = id => document.getElementById(id);
const gameArea = $('game-area');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INITIALIZATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function init() {
  // Road dashes
  const road = $('road');
  for (let i = 0; i < 20; i++) {
    const d = document.createElement('div');
    d.className = 'road-dash';
    d.style.left = (i * 42 + 10) + 'px';
    road.appendChild(d);
  }

  // Station click handlers
  document.querySelectorAll('.station').forEach(el => {
    el.addEventListener('click', () => {
      if (G.screen !== 'playing') return;
      const id = el.id;
      let key = null;
      if (id.startsWith('pump-')) key = 'pump' + id.split('-')[1];
      else if (id === 'parking-station') key = 'parking';
      else if (id === 'bathroom-station') key = 'bathroom';
      else if (id === 'counter-station') key = 'counter';
      else if (id === 'cooler-station') key = 'coolers';
      else if (id === 'floor-station') key = 'floor';
      if (key) assignClerk(key);
    });
  });

  // High score display
  const hs = localStorage.getItem('gsf-highscore');
  if (hs) $('title-highscore').innerHTML = 'High Score: <span>$' + hs + '</span>';

  // Responsive scaling
  resize();
  window.addEventListener('resize', resize);
}

function resize() {
  const w = document.getElementById('game-wrapper');
  const scaleX = window.innerWidth / 820;
  const scaleY = window.innerHeight / 640;
  const s = Math.min(scaleX, scaleY, 1);
  w.style.transform = 'scale(' + s + ')';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCREEN MANAGEMENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showScreen(name) {
  ['title-screen','dayend-screen','gameover-screen'].forEach(id => {
    $(id).classList.toggle('show', id.startsWith(name.replace('Screen','')));
  });
  if (name === 'title') $('title-screen').classList.add('show');
  if (name === 'dayend') $('dayend-screen').classList.add('show');
  if (name === 'gameover') $('gameover-screen').classList.add('show');
}

function hideAllScreens() {
  ['title-screen','dayend-screen','gameover-screen'].forEach(id => $(id).classList.remove('show'));
}

window.startGame = function() {
  G = freshState();
  G.screen = 'playing';
  G.dayStarted = true;
  hideAllScreens();
  showDayBanner();
};

window.restartGame = function() {
  G = freshState();
  G.screen = 'title';
  hideAllScreens();
  showScreen('title');
  const hs = localStorage.getItem('gsf-highscore');
  if (hs) $('title-highscore').innerHTML = 'High Score: <span>$' + hs + '</span>';
};

window.nextDay = function() {
  G.day++;
  G.dayMoney = 0;
  G.dayCustomers = 0;
  G.timeLeft = DAY_LENGTH;
  G.satisfaction = Math.min(100, G.satisfaction + 10);
  G.clerk = { x:400, y:510, targetKey:null, arrived:false, taskProgress:0, taskDuration:0 };
  G.pumps.forEach(p => { p.state = 'empty'; p.patience = 0; p.fillProgress = 0; });
  G.coolerStock = Math.min(100, G.coolerStock + 30);
  G.counterQueue = 0;
  G.counterPatience = 0;
  G.bathroomClean = Math.min(100, G.bathroomClean + 20);
  G.floorClean = Math.min(100, G.floorClean + 20);
  G.parkingClean = Math.min(100, G.parkingClean + 20);
  G.nextCarTimer = 3;
  G.nextCounterTimer = 8;
  G.screen = 'playing';
  G.paused = false;
  hideAllScreens();
  showDayBanner();
};

function showDayBanner() {
  const banner = $('day-banner');
  banner.textContent = 'Day ' + G.day;
  banner.classList.remove('show');
  void banner.offsetWidth;
  banner.classList.add('show');
}

function endDay() {
  G.paused = true;
  const cfg = dayConfig(G.day);
  const tipRate = G.satisfaction / 100;
  const tips = Math.round(G.dayMoney * tipRate * 0.2);
  const total = G.dayMoney + tips;
  const metGoal = total >= cfg.goal;

  // Update high score
  const hs = parseInt(localStorage.getItem('gsf-highscore') || '0');
  if (G.totalMoney + tips > hs) localStorage.setItem('gsf-highscore', G.totalMoney + tips);

  G.totalMoney += tips;

  $('dayend-title').textContent = metGoal ? 'ğŸ‰ Day ' + G.day + ' Complete!' : 'ğŸ˜… Day ' + G.day + ' Over';
  $('dayend-stats').innerHTML =
    'Earnings: <span>$' + G.dayMoney + '</span><br>' +
    'Tip Bonus (' + Math.round(tipRate * 100) + '%): <span>+$' + tips + '</span><br>' +
    'Day Total: <span>$' + total + '</span> / Goal: $' + cfg.goal + '<br>' +
    'Customers Served: <span>' + G.dayCustomers + '</span><br>' +
    'Satisfaction: <span>' + Math.round(G.satisfaction) + '%</span><br>' +
    'Total Bank: <span>$' + G.totalMoney + '</span>';

  $('dayend-btn').textContent = metGoal ? 'Next Day â†’' : 'Try Again';
  $('dayend-btn').onclick = metGoal ? window.nextDay : function() {
    G.day--;
    window.nextDay();
  };

  G.screen = 'dayend';
  showScreen('dayend');
}

function gameOver(reason) {
  G.paused = true;
  const hs = parseInt(localStorage.getItem('gsf-highscore') || '0');
  if (G.totalMoney > hs) localStorage.setItem('gsf-highscore', G.totalMoney);

  $('gameover-reason').textContent = reason;
  $('gameover-stats').innerHTML =
    'Survived: <span>' + G.day + ' day' + (G.day > 1 ? 's' : '') + '</span><br>' +
    'Total Earned: <span>$' + G.totalMoney + '</span><br>' +
    'Customers Served: <span>' + G.customersServed + '</span>';

  G.screen = 'gameover';
  showScreen('gameover');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLERK SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function assignClerk(stationKey) {
  if (!canDoTask(stationKey)) return;
  const c = G.clerk;
  // If already performing a task at the same station, ignore
  if (c.targetKey === stationKey && c.arrived && c.taskProgress > 0) return;
  c.targetKey = stationKey;
  c.arrived = false;
  c.taskProgress = 0;
  c.taskDuration = TASK_DURATION[stationKey];
  // Remove active highlight from all stations
  document.querySelectorAll('.station.active').forEach(el => el.classList.remove('active'));
  // Highlight target station
  const el = stationElement(stationKey);
  if (el) el.classList.add('active');
}

function canDoTask(key) {
  if (key.startsWith('pump')) {
    const idx = parseInt(key.replace('pump',''));
    return G.pumps[idx].state === 'waiting';
  }
  if (key === 'counter') return G.counterQueue > 0;
  if (key === 'coolers') return G.coolerStock < 90;
  if (key === 'bathroom') return G.bathroomClean < 90;
  if (key === 'floor') return G.floorClean < 90;
  if (key === 'parking') return G.parkingClean < 90;
  return false;
}

function stationElement(key) {
  if (key.startsWith('pump')) return $('pump-' + key.replace('pump',''));
  if (key === 'parking') return $('parking-station');
  if (key === 'bathroom') return $('bathroom-station');
  if (key === 'counter') return $('counter-station');
  if (key === 'coolers') return $('cooler-station');
  if (key === 'floor') return $('floor-station');
  return null;
}

function updateClerk(dt) {
  const c = G.clerk;
  if (!c.targetKey) return;

  const target = STATION_POS[c.targetKey];
  if (!target) return;

  if (!c.arrived) {
    const dx = target.x - c.x;
    const dy = target.y - c.y;
    const dist = Math.sqrt(dx * dx + dy * dy);
    if (dist < 5) {
      c.x = target.x;
      c.y = target.y;
      c.arrived = true;
      c.taskProgress = 0;
    } else {
      const speed = CLERK_SPEED * dt;
      c.x += (dx / dist) * speed;
      c.y += (dy / dist) * speed;
    }
  } else {
    // Check if task is still valid
    if (!canDoTask(c.targetKey)) {
      completeClerkTask();
      return;
    }
    c.taskProgress += dt;
    if (c.taskProgress >= c.taskDuration) {
      completeClerkTask();
    }
  }
}

function completeClerkTask() {
  const c = G.clerk;
  const key = c.targetKey;
  if (!key) return;

  if (key.startsWith('pump')) {
    const idx = parseInt(key.replace('pump',''));
    if (G.pumps[idx].state === 'waiting') {
      G.pumps[idx].state = 'filling';
      G.pumps[idx].fillProgress = 0;
    }
  } else if (key === 'coolers') {
    G.coolerStock = 100;
    spawnFloat(STATION_POS.coolers.x, STATION_POS.coolers.y - 30, 'Restocked!', false);
  } else if (key === 'counter') {
    if (G.counterQueue > 0 && G.coolerStock > 0) {
      G.counterQueue--;
      G.coolerStock = Math.max(0, G.coolerStock - randInt(12, 20));
      const pay = randInt(3, 9);
      earnMoney(pay, STATION_POS.counter.x, STATION_POS.counter.y - 30);
    }
  } else if (key === 'bathroom') {
    G.bathroomClean = 100;
    spawnFloat(STATION_POS.bathroom.x, STATION_POS.bathroom.y - 30, 'Sparkling!', false);
  } else if (key === 'floor') {
    G.floorClean = 100;
    spawnFloat(STATION_POS.floor.x, STATION_POS.floor.y - 30, 'Spotless!', false);
  } else if (key === 'parking') {
    G.parkingClean = 100;
    spawnFloat(STATION_POS.parking.x, STATION_POS.parking.y - 30, 'Swept!', false);
  }

  // Remove active highlight
  const el = stationElement(key);
  if (el) el.classList.remove('active');

  c.targetKey = null;
  c.arrived = false;
  c.taskProgress = 0;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CUSTOMER SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function spawnCar() {
  const cfg = dayConfig(G.day);
  // Find an empty pump
  const empties = [];
  G.pumps.forEach((p, i) => { if (p.state === 'empty') empties.push(i); });
  if (empties.length === 0) return;
  const idx = empties[randInt(0, empties.length - 1)];
  const pump = G.pumps[idx];
  pump.state = 'waiting';
  pump.patience = cfg.patience + randInt(-3, 3);
  pump.maxPatience = pump.patience;
  pump.fillProgress = 0;
  pump.carType = CARS[randInt(0, CARS.length - 1)];
  pump.payment = randInt(8, 20);
  $('car-' + idx).textContent = pump.carType;
}

function spawnCounterCustomer() {
  if (G.counterQueue >= 3) return;
  const cfg = dayConfig(G.day);
  G.counterQueue++;
  G.counterPatience = cfg.patience * 0.8;
  G.counterMaxPatience = G.counterPatience;
}

function updateCustomers(dt) {
  const cfg = dayConfig(G.day);

  // Spawn cars
  G.nextCarTimer -= dt;
  if (G.nextCarTimer <= 0) {
    spawnCar();
    G.nextCarTimer = cfg.carInterval + randFloat(-2, 2);
  }

  // Spawn counter customers
  G.nextCounterTimer -= dt;
  if (G.nextCounterTimer <= 0) {
    spawnCounterCustomer();
    G.nextCounterTimer = cfg.counterInterval + randFloat(-2, 2);
  }

  // Update pump patience & filling
  G.pumps.forEach((p, i) => {
    if (p.state === 'waiting') {
      p.patience -= dt;
      if (p.patience <= 0) {
        // Customer leaves angry
        p.state = 'empty';
        G.satisfaction = Math.max(0, G.satisfaction - 8);
        spawnFloat(STATION_POS['pump' + i].x, STATION_POS['pump' + i].y - 30, 'ğŸ˜  Left!', true);
        // Cancel clerk task if heading here
        if (G.clerk.targetKey === 'pump' + i) {
          const el = stationElement('pump' + i);
          if (el) el.classList.remove('active');
          G.clerk.targetKey = null;
          G.clerk.arrived = false;
        }
      }
    } else if (p.state === 'filling') {
      p.fillProgress += dt;
      if (p.fillProgress >= 5) {
        // Done filling, customer pays
        p.state = 'empty';
        earnMoney(p.payment, STATION_POS['pump' + i].x, STATION_POS['pump' + i].y - 30);
        G.satisfaction = Math.min(100, G.satisfaction + 1.5);
      }
    }
  });

  // Update counter patience
  if (G.counterQueue > 0) {
    G.counterPatience -= dt;
    if (G.counterPatience <= 0) {
      G.counterQueue = Math.max(0, G.counterQueue - 1);
      G.satisfaction = Math.max(0, G.satisfaction - 5);
      spawnFloat(STATION_POS.counter.x, STATION_POS.counter.y - 30, 'ğŸ˜  Left!', true);
      if (G.counterQueue > 0) {
        G.counterPatience = cfg.patience * 0.8;
        G.counterMaxPatience = G.counterPatience;
      }
      if (G.clerk.targetKey === 'counter' && G.counterQueue === 0) {
        const el = stationElement('counter');
        if (el) el.classList.remove('active');
        G.clerk.targetKey = null;
        G.clerk.arrived = false;
      }
    }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEGRADATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateDegradation(dt) {
  const cfg = dayConfig(G.day);
  const m = cfg.degradeMultiplier;

  G.coolerStock = Math.max(0, G.coolerStock - 1.2 * m * dt);
  G.bathroomClean = Math.max(0, G.bathroomClean - 0.9 * m * dt);
  G.floorClean = Math.max(0, G.floorClean - 0.7 * m * dt);
  G.parkingClean = Math.max(0, G.parkingClean - 0.55 * m * dt);

  // Satisfaction drain from dirty areas
  if (G.bathroomClean < 40) G.satisfaction = Math.max(0, G.satisfaction - 0.3 * m * dt);
  if (G.floorClean < 40) G.satisfaction = Math.max(0, G.satisfaction - 0.2 * m * dt);
  if (G.parkingClean < 40) G.satisfaction = Math.max(0, G.satisfaction - 0.15 * m * dt);
  if (G.coolerStock < 15) G.satisfaction = Math.max(0, G.satisfaction - 0.15 * m * dt);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MONEY & EFFECTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function earnMoney(amount, x, y) {
  G.dayMoney += amount;
  G.totalMoney += amount;
  G.dayCustomers++;
  G.customersServed++;
  spawnFloat(x, y, '+$' + amount, false);
}

function spawnFloat(x, y, text, isBad) {
  const el = document.createElement('div');
  el.className = 'float-text' + (isBad ? ' bad' : '');
  el.textContent = text;
  el.style.left = (x - 25) + 'px';
  el.style.top = y + 'px';
  gameArea.appendChild(el);
  setTimeout(() => el.remove(), 1300);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDERING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function render() {
  // HUD
  $('hud-money').textContent = '$' + G.totalMoney;
  $('hud-day').textContent = 'Day ' + G.day;
  const mins = Math.floor(Math.max(0, G.timeLeft) / 60);
  const secs = Math.floor(Math.max(0, G.timeLeft) % 60);
  $('hud-time').textContent = mins + ':' + (secs < 10 ? '0' : '') + secs;
  const timeEl = $('hud-time');
  timeEl.className = 'hud-val' + (G.timeLeft < 15 ? ' danger' : G.timeLeft < 30 ? ' warn' : '');

  const satPct = Math.round(G.satisfaction);
  $('hud-sat').textContent = satPct + '%';
  $('hud-sat').className = 'hud-val' + (satPct < 30 ? ' danger' : satPct < 60 ? ' warn' : '');
  $('sat-fill').style.width = satPct + '%';
  $('sat-fill').style.background = satPct < 30 ? '#fc8181' : satPct < 60 ? '#fbd38d' : '#68d391';

  const cfg = dayConfig(G.day);
  $('hud-goal').textContent = '$' + G.dayMoney + '/$' + cfg.goal;
  $('hud-goal').className = 'hud-val' + (G.dayMoney >= cfg.goal ? '' : G.timeLeft < 30 ? ' warn' : '');

  // Pumps
  G.pumps.forEach((p, i) => {
    const el = $('pump-' + i);
    const bar = $('pump-' + i + '-bar');
    const sub = $('pump-' + i + '-sub');
    const car = $('car-' + i);

    car.classList.toggle('visible', p.state !== 'empty');
    car.textContent = p.carType;

    if (p.state === 'empty') {
      sub.textContent = 'Available';
      bar.style.width = '0%';
      bar.className = 'sbar-fill green';
      el.classList.remove('needs-attention', 'critical');
    } else if (p.state === 'waiting') {
      const pct = (p.patience / p.maxPatience) * 100;
      sub.textContent = 'â³ Waiting...';
      bar.style.width = pct + '%';
      bar.className = 'sbar-fill ' + (pct < 30 ? 'red' : pct < 60 ? 'yellow' : 'green');
      el.classList.toggle('needs-attention', pct >= 30 && pct < 60);
      el.classList.toggle('critical', pct < 30);
    } else if (p.state === 'filling') {
      const pct = (p.fillProgress / 5) * 100;
      sub.textContent = 'â›½ Filling...';
      bar.style.width = pct + '%';
      bar.className = 'sbar-fill blue';
      el.classList.remove('needs-attention', 'critical');
    }
  });

  // Coolers
  renderCleanStation('cooler', G.coolerStock, 'Stocked', 'Low Stock!', 'Empty!');
  $('cooler-bar').className = 'sbar-fill ' + (G.coolerStock < 20 ? 'red' : G.coolerStock < 50 ? 'yellow' : 'blue');

  // Counter
  const counterEl = $('counter-station');
  if (G.counterQueue > 0) {
    $('counter-sub').textContent = 'ğŸ‘¤ Ã—' + G.counterQueue;
    const pct = (G.counterPatience / G.counterMaxPatience) * 100;
    $('counter-bar').style.width = pct + '%';
    $('counter-bar').className = 'sbar-fill ' + (pct < 30 ? 'red' : pct < 60 ? 'yellow' : 'green');
    counterEl.classList.toggle('needs-attention', pct >= 30);
    counterEl.classList.toggle('critical', pct < 30);
  } else {
    $('counter-sub').textContent = 'No customers';
    $('counter-bar').style.width = '0%';
    counterEl.classList.remove('needs-attention', 'critical');
  }

  // Cleaning stations
  renderCleanStation('bathroom', G.bathroomClean, 'Clean', 'Needs Cleaning', 'Filthy!');
  renderCleanStation('floor', G.floorClean, 'Clean', 'Needs Mopping', 'Filthy!');
  renderCleanStation('parking', G.parkingClean, 'Clean', 'Needs Sweeping', 'Littered!');

  // Clerk position
  const clerk = $('clerk');
  clerk.style.left = (G.clerk.x - 15) + 'px';
  clerk.style.top = (G.clerk.y - 15) + 'px';

  // Clerk label
  const clerkLabel = $('clerk-label');
  clerkLabel.style.left = (G.clerk.x - 30) + 'px';
  clerkLabel.style.top = (G.clerk.y - 32) + 'px';
  if (G.clerk.targetKey) {
    clerkLabel.classList.add('visible');
    if (G.clerk.arrived) {
      clerkLabel.textContent = 'Working...';
    } else {
      clerkLabel.textContent = 'Going â†’';
    }
  } else {
    clerkLabel.classList.remove('visible');
  }

  // Clerk progress ring
  const progRing = $('prog-ring');
  const clerkProg = $('clerk-progress');
  clerkProg.style.left = (G.clerk.x - 18) + 'px';
  clerkProg.style.top = (G.clerk.y - 18) + 'px';
  if (G.clerk.arrived && G.clerk.targetKey && G.clerk.taskDuration > 0) {
    const pct = G.clerk.taskProgress / G.clerk.taskDuration;
    progRing.setAttribute('stroke-dashoffset', 94.25 * (1 - pct));
    clerkProg.style.opacity = '1';
  } else {
    clerkProg.style.opacity = '0';
  }
}

function renderCleanStation(key, value, goodText, warnText, badText) {
  const el = $(key + '-station');
  const bar = $(key + '-bar');
  const sub = $(key + '-sub');
  bar.style.width = value + '%';
  if (value > 60) {
    sub.textContent = goodText;
    bar.className = 'sbar-fill green';
    el.classList.remove('needs-attention', 'critical');
  } else if (value > 25) {
    sub.textContent = warnText;
    bar.className = 'sbar-fill yellow';
    el.classList.add('needs-attention');
    el.classList.remove('critical');
  } else {
    sub.textContent = badText;
    bar.className = 'sbar-fill red';
    el.classList.remove('needs-attention');
    el.classList.add('critical');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME LOOP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let lastTime = 0;

function gameLoop(timestamp) {
  requestAnimationFrame(gameLoop);
  if (!lastTime) { lastTime = timestamp; return; }
  const dt = Math.min((timestamp - lastTime) / 1000, 0.1);
  lastTime = timestamp;

  if (G.screen !== 'playing' || G.paused) return;

  // Timer
  G.timeLeft -= dt;
  if (G.timeLeft <= 0) {
    G.timeLeft = 0;
    endDay();
    return;
  }

  // Game over check
  if (G.satisfaction <= 0) {
    G.satisfaction = 0;
    gameOver('The health inspector shut you down! Satisfaction hit 0%.');
    return;
  }

  updateCustomers(dt);
  updateDegradation(dt);
  updateClerk(dt);
  render();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILITIES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function randInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
function randFloat(min, max) { return Math.random() * (max - min) + min; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// START
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
init();
requestAnimationFrame(gameLoop);
</script>
</body>
</html>
